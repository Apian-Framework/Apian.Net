<!DOCTYPE html>

<head>
  <meta charset="utf-8">

  <title>Apian Peer Architecture</title>
  <link href="./explainer-styles.css" rel="stylesheet" />
  <link href="./2-arch-slide.css" rel="stylesheet" />

</head>
<body class="bk-y">
    <div id="main" class="main bk-y">

        <div id="slide" class="slide bk-y"  >
            <img class="anim" id="apian-logo" src="img/apian-logo-sm.png"/>
            <h1 class="slide-title" id="slide-title">Apian Peer Architecture</h1>
            <div class="slide-content" id="slide-content">
                <div class="anim" id="app-frame">
                    <img class="anim" id="apian-bkg" src="img/apian-bkg.png"/>    <!-- goes behind core frame -->
                    <div class="anim" id="core-frame">
                        <img class="anim" id="core-frame-img" src="img/core-frame.png"/>
                        <img class="anim" id="core-logic" src="img/core-logic.png"/>
                        <h1 class="slide-title" id="appcore-title">AppCore</h1>
                        <img class="anim" id="core-work-arw" src="img/work-arw.png"/>
                        <img class="anim" id="core-state" src="img/core-state.png"/>
                        <img class="anim" id="core-state-hole" src="img/hole.png"/>
                        <img class="anim" id="plane-rd-lt" src="img/plane-rd-lt.png"/>
                        <img class="anim" id="plane-rd-rt" src="img/plane-rd-rt.png"/>
                        <img class="anim" id="plane-bl-lt" src="img/plane-bl-lt.png"/>
                        <img class="anim" id="plane-bl-rt" src="img/plane-bl-rt.png"/>
                        <img class="anim" id="core-arw" src="img/core-arw.png"/>
                    </div>

                    <img class="anim" id="qmark" src="img/qmark.png"/>
                    <img class="anim" id="apian" src="img/apian.png"/>
                    <img class="anim" id="ap-core-arw" src="img/ap-core-arw.png"/>
                    <img class="anim" id="apian-work-arw" src="img/work-arw.png"/>

                    <img class="anim" id="app-code" src="img/app-code.png"/>
                    <img class="anim" id="the-ai" src="img/ai.png"/>
                    <img class="anim" id="app-eye" src="img/app-eye.png"/>
                    <img class="anim" id="app-ap-arw" src="img/app-ap-arw.png"/>
                    <img class="anim" id="app-core-arw" src="img/app-core-arw.png"/>
                    <img class="anim" id="app-work-arw" src="img/work-arw.png"/>

                    <img class="anim" id="screen" src="img/screen.png"/>
                    <img class="anim" id="app-scrn-arw" src="img/app-scrn-arw.png"/>

                    <img class="anim" id="player" src="img/plyr.png"/>
                    <img class="anim" id="plyr-app-arw" src="img/plyr-app-arw.png"/>

                    <img class="anim" id="big-red-x" src="img/big-red-x.png"/>

                    <img class="anim" id="cloud-sm" src="img/apian-cloud-sm.png"/>
                    <img class="anim" id="cloud-zoom" src="img/apian-zoom-lines.png"/>
                    <img class="anim" id="cloud-flash" src="img/apian-zoom-flash.png"/>

                    <img class="anim" id="spark1" src="img/msg.png" />
                    <img class="anim" id="cmd1" src="img/command.png" />
                    <img class="anim" id="req1" src="img/request.png" />
                    <img class="anim" id="obs1" src="img/observation.png" />

                </div>

                <div class="narrative line1" id="nar1">&#11041; Start with the simplest data model that can possibly represent your app.</div>
                <div class="narrative line2" id="nar2">&nbsp;&nbsp;(If it were a paper game, what would the board, pieces and scorepads be like?)</div>

                <div class="narrative line3" id="nar3">&#11041; This is your CORE STATE</div>
                <div class="narrative line4" id="nar4">&nbsp;&nbsp;It's ok for everything to be able to see it, but NOTHING CAN CHANGE IT.</div>

                <div class="narrative line5" id="nar5">&#11041; ...Except CORE LOGIC.</div>
                <div class="narrative line6" id="nar6">&nbsp;&nbsp; which is the only code allowed to update the Core State.</div>

                <div class="narrative line4" id="nar7">&#11041; Core Logic and Core State make up the APP CORE.</div>
                <div class="narrative line5" id="nar8">&nbsp;&nbsp;The idea is for pre-defined, high-level, application-domain directives to be sent to the AppCore and for the Core Logic to interpret them and make the appropriate low-level changes to the state data.</div>
                <div class="narrative line8" id="nar9">&nbsp;&nbsp;And this is the ONLY way to modify the Core State.</div>

                <div class="narrative line2" id="nar10">Some AppCore rules:</div>
                <div class="narrative line3" id="nar11">&#11041; State can be seen and queried by everyone.</div>
                <div class="narrative line4" id="nar12">&#11041; State can ONLY be modified via external commands.</div>
                <div class="narrative line5" id="nar13">&#11041; Logic must be deterministic. Cannot contain any stochastic code.</div>
                <div class="narrative line6" id="nar14">&#11041; ...other stuff I can't think of right now...</div>

                <div class="narrative line8" id="nar15">An AppCore instance contains all of the rules, logic, and state to perform the fundamental work of the application, but that's clearly not enough to be standalone application.</div>

                <div class="narrative line6" id="nar16">&nbsp;&nbsp; We're going to refer to the rest simply as the APPLICATION CODE.</div>
                <div class="narrative line7" id="nar17">&#11041; It handles front-end tasks like rendering the CoreState for users.</div>
                <div class="narrative line8" id="nar18">&#11041; As well as dispatching user input.</div>
                <div class="narrative line8" id="nar19">&#11041; As well as dispatching user input - which is wrapped in a Command and sent to the AppCore.</div>

                <div class="narrative line6" id="nar20">As mentioned earlier, random behavior is not allowed in the AppCore.</div>
                <div class="narrative line7" id="nar21">So any randomly acting code - like an AI - has to live in the Application Code.</div>
                <div class="narrative line8" id="nar22">This is actually pretty cool, since now the AI and User actions work exactly the same way.</div>

                <div class="narrative line6" id="nar23">Sending commands directly to the AppCore works pretty well for a single-user app.</div>
                <div class="narrative line7" id="nar24">But that's not what we're trying to do.</div>
                <div class="narrative line8" id="nar25">Which brings us to a new component: Apian</div>

                <div class="narrative line6" id="nar26">Apian defines 3 types of wrapper messages:</div>
                <div class="narrative line7" id="nar27">&nbsp;&nbsp;Commands - tell the AppCore to apply an application directive to the Core State.</div>
                <div class="narrative line8" id="nar28">&nbsp;&nbsp;Requests from the Application Code *ask* that a directive be applied.</div>
                <div class="narrative line9" id="nar29">&nbsp;&nbsp;Observations are similar to Requests, but originate from the AppCore itself.</div>

                <div class="narrative line6" id="nar30">An Apian instance is paired with an AppCore instance.</div>
                <div class="narrative line7" id="nar31">(yes, that implies that there can be more than one Apian/AppCore pair)</div>
                <div class="narrative line8" id="nar32">But the important thing about an Apian instance is that it is actually a proxy...</div>
                <div class="narrative line9" id="nar33">...for an aggregate "Apian Collective" object.</div>

                <div class="narrative line8" id="narsorry">Sorry! This is as far as I've gotten for now...</div>

            </div>

        </div>

        <div id="shuttle" class="shuttle" ">
            <div id="rewind" onClick="rewind()"><<</div><div id="play" onClick="play_to_next()">Next</div><div id="fwd" onClick="fast_fwd()" >>></div>
            <div id="searchlabels" onClick="toggle_goto()">&#x1F50D;&#xFE0E;</div>
            <div id="goto" class="goto"><select id="gotoList" name="gotoList" onChange="goto_label()"></select></div>
        </div>




    </div>

    <script src="./gsap/minified/gsap.min.js"></script>

    <script>

        function coreWorkAnim() {
            return gsap.timeline()
            .fromTo("#core-work-arw", {scale: .1, autoAlpha: 0}, {duration: .25, scale: 1, autoAlpha: 1})
            .fromTo("#core-work-arw", {rotate: 0}, {duration: 1, repeat: 1, rotate: 360, ease: "none"}, "<")
            .fromTo("#core-work-arw", {filter: "none"}, {filter: "blur(1px)", duration: 1, repeat: 1,  yoyo: true, ease: "circ"}, "<")
            .to("#core-work-arw", {duration: .25, scale: .1, autoAlpha: 0});
        }

        function coreArrowAnim() {
            return gsap.timeline()
            .fromTo("#core-arw", {tscale: .1, autoAlpha: 0},  {duration: .25, transformOrigin: "left", scale: 1, autoAlpha: 1, ease: "none"})
            .fromTo("#core-state-hole", { scale: .1, autoAlpha: 0}, {duration: .25, scale: 1, autoAlpha: 1, ease: "none"}, "<")
            .to("#core-arw", {duration: .25, repeat: 5, yoyo: true, transformOrigin: "left", scaleX: 1.25, ease: "none"}, ">")
            .to("#core-arw", {duration: .25, transformOrigin: "left", scale: .1, autoAlpha: 0, ease: "none"}, ">")
            .to("#core-state-hole", {duration: .25, scale: .1, autoAlpha: 0, ease: "none"}, ">");
        }

        function planeMove1() {
            return gsap.timeline()
            .to("#plane-bl-rt", {duration: .5, x: 77})
            .to("#plane-bl-rt", {duration: .5, rotation: -45});
        }

        function undoPlaneMove1() {
            return gsap.timeline()
            .to("#plane-bl-rt", {duration: .5, autoAlpha: 0})
            .set("#plane-bl-rt", {duration: .5, x: 0, rotation: 0}, ">")
            .to("#plane-bl-rt", {duration: .5, autoAlpha: 1},">");

        }

        function appWorkAnim() {
            return gsap.timeline()
            .fromTo("#app-work-arw", {scale: .1, autoAlpha: 0}, {duration: .25, scale: 1, autoAlpha: 1})
            .fromTo("#app-work-arw", {rotate: 0}, {duration: 1, repeat: 1, rotate: 360, ease: "none"}, "<")
            .fromTo("#app-work-arw", {filter: "none"}, {filter: "blur(1px)", duration: 1, repeat: 1,  yoyo: true, ease: "circ"}, "<")
            .to("#app-work-arw", {duration: .25, scale: .1, autoAlpha: 0});
        }

        function apianWorkAnim() {
            return gsap.timeline()
            .fromTo("#apian-work-arw", {scale: .1, autoAlpha: 0}, {duration: .25, scale: 1, autoAlpha: 1})
            .fromTo("#apian-work-arw", {rotate: 0}, {duration: 1, repeat: 1, rotate: 360, ease: "none"}, "<")
            .fromTo("#apian-work-arw", {filter: "none"}, {filter: "blur(1px)", duration: 1, repeat: 1,  yoyo: true, ease: "circ"}, "<")
            .to("#apian-work-arw", {duration: .25, scale: .1, autoAlpha: 0});
        }

        function updateScreen() {
            return gsap.timeline()
            .to("#app-eye", {duration: .2, repeat: 4, yoyo: true, autoAlpha: 1},)
            .add(appWorkAnim())
            .to("#app-eye", {duration: .25, autoAlpha: 0},">")
            .from("#app-scrn-arw", {duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "bottom left"})
            .fromTo("#screen", {autoAlpha: 0}, {duration: .25, autoAlpha: 1},">-.25")
            .to("#screen", {duration: .2,  repeat: 3, yoyo: true, scale: 1.1, ease: "none"},">")

            .to("#app-scrn-arw", {duration: .5, autoAlpha: 0},);
        }

        function inputFromUser() {
            return gsap.timeline()
                .fromTo("#plyr-app-arw", {autoAlpha: 0, scale: .1},{duration: 1, autoAlpha: 1, scale: 1, transformOrigin: "top right"})
                .fromTo("#spark1",   {scale: .1, autoAlpha: 0}, {duration: .5, scale: 1, autoAlpha: 1},">")
                .fromTo("#spark1", {x: 760, y:460}, {x: 380, y:520, duration: 1}, "<")
                .to("#plyr-app-arw", {duration: 1, autoAlpha: 0, scale: .1, transformOrigin: "bottom left"},">");
        }

        function inputFromAI() {
            return gsap.timeline()
                .fromTo("#spark1",  {scale: .1, autoAlpha: 0, x: 520, y:555}, {duration: .5, scale: 1, autoAlpha: 1})
                .to("#spark1", {x: 380, y:520, duration: .5}, ">")
        }

        function hilightNar(sel)
        {
            gsap.set("div.narrative", {color: "var(--nar-color)"});
            gsap.set( sel, {color: "var(--nar-hi-color)"});
        }

        var tLine = gsap.timeline();

        tLine.set("#slide-content", { scale: .85, x: 120} );

        //tLine.addLabel("titleIn");
        tLine.to("#slide-title", {duration: 2, autoAlpha: 1});
        tLine.to("#apian-logo", {duration: 2, autoAlpha: 1}, "<");
        tLine.from("#slide-title", {duration: 1, y: -80}, "<");
        tLine.from("#apian-logo",  {duration: 1, y: -80}, "<");

        tLine.addLabel("startWords");
        tLine.from("#nar1",  {duration: 1, autoAlpha: 0, x: -1000, onStart: ()=>hilightNar("#nar1") });
        tLine.from("#nar2",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar2")}, ">+1");

        tLine.addLabel("coreState");
        tLine.to("#app-frame", {duration: 0, autoAlpha: 1, backgroundColor: "transparent"});
        tLine.to("#core-frame", {duration: 0, autoAlpha: 1, backgroundColor:"transparent"}, "<");
        tLine.from("#core-state", {duration: 1, rotation: -360, scale: .1, autoAlpha: 0} , "<");
        tLine.to(["#plane-rd-lt", "#plane-bl-lt", "#plane-rd-rt", "#plane-bl-rt"], {duration: .5, stagger: .25, autoAlpha: 1} , ">");

        tLine.from("#nar3",  {duration: 1, autoAlpha: 0,onStart: ()=>hilightNar("#nar3")}, ">");
        tLine.from("#nar4",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar4")}, ">+1");

        tLine.addLabel("coreLogic");
        tLine.to("#core-frame", {duration: 1, backgroundColor: "#fdf3c9"});
        tLine.to("#core-frame-img", {duration: 1, autoAlpha: 1}, "<");
        tLine.from("#core-logic", {duration: 1, scale: .1, autoAlpha: 0, ease: "bounce"}, "<");
        tLine.to("#app-frame", {duration: 1, x:140}, "<");
        tLine.from("#nar5",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar5")}, ">");
        tLine.from("#nar6",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar6")}, ">+1");

        tLine.addLabel("calledAppCore");
        tLine.to("#nar1",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar2",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar3",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar4",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar5",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar6",  {duration: .1, autoAlpha: 0})
        tLine.from("#nar7",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar7")});
        tLine.to("#appcore-title", {duration: 1, autoAlpha: 1}, ">");

        tLine.addLabel("theBasicIdea");
        tLine.from("#nar8",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar8")}, ">");

        tLine.addLabel("stateChange");
        tLine.from("#qmark",   {duration: .5, scale: .1, autoAlpha: 0}, ">");
        tLine.from("#ap-core-arw", {duration: .5,  scale: .1, autoAlpha: 0, transformOrigin: "bottom", ease: "none"}, ">+.5");
        tLine.set("#cmd1", {x: 120, y:460});
        tLine.from("#cmd1",   {duration: .5, scale: .1, autoAlpha: 0}, ">");
        // SHould this be a func?
        tLine.to("#cmd1", {x: 125, y:150, duration: 1}, "<");
        tLine.to("#ap-core-arw", {duration: .5,  scale: .1, autoAlpha: 0, transformOrigin: "top", ease: "none"}, ">+.5");
        tLine.add(coreWorkAnim());
        tLine.add(coreArrowAnim(), ">-.25")
        tLine.add(planeMove1(), "<+.25");
        tLine.to("#cmd1", {duration: .5, autoAlpha: 0}, "<");
        tLine.from("#nar9",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar9")});

        tLine.addLabel("aboutAppCore");
        tLine.to("#qmark", {duration: .5, autoAlpha: 0});
        tLine.to("#nar9",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar8",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar7",  {duration: .1, autoAlpha: 0});
        tLine.add(undoPlaneMove1(), "<-.3");
        tLine.from("#nar10",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar10")});

        tLine.addLabel("thing1");
        tLine.from("#nar11",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar11")});

        tLine.addLabel("thing2");
        tLine.from("#nar12",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar12")});

        tLine.addLabel("thing3");
        tLine.from("#nar13",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar13")});

        tLine.addLabel("thing4");
        tLine.from("#nar14",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar14")});

        tLine.addLabel("notEnough");
        tLine.from("#nar15",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar15")});

        tLine.addLabel("AppCode");
        tLine.to("#nar10",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar11",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar12",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar13",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar14",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar15",  {duration: .1, autoAlpha: 0});
        tLine.to("#core-frame", {duration: 1, backgroundColor: "#ffffff"});
        tLine.to("#app-frame", {duration: 1, backgroundColor: "#fdf3c9"}, "<");
        tLine.from("#app-code", {duration: 1, scale: .1, autoAlpha: 0, ease: "bounce"}, "<");
        tLine.from("#nar16",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar16")}, ">");

        tLine.addLabel("StateDisplay");
        tLine.from("#nar17",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar17")});
        tLine.add(updateScreen());

        tLine.addLabel("UserInput");
        tLine.to("#player", {duration: 1, autoAlpha: 1});
        tLine.from("#nar18",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar18")}, ">");
        tLine.add(inputFromUser());

        tLine.addLabel("CommandFromApp");
        tLine.to("#nar18",  {duration: 1, autoAlpha: 0});
        tLine.from("#nar19",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar19")}, "<");
        tLine.set("#cmd1", {x: 380, y: 520}, ">+1");
        tLine.add(appWorkAnim());
        tLine.fromTo("#cmd1", {autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");

        tLine.from("#app-core-arw", {duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "bottom right"}, ">");
        tLine.to("#cmd1", {x: 125, y:150, duration: 1}, ">");
        tLine.to("#spark1", {x: 125, y:150, duration: 1}, "<");
        tLine.to("#app-core-arw", {duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "top left"}, ">");
        tLine.add(coreWorkAnim());
        tLine.to("#cmd1", {duration: 1, autoAlpha: 0}, "<");
        tLine.add(coreArrowAnim(), ">-.25")
        tLine.add(planeMove1(), "<+.25");
        tLine.to("#spark1", {duration: 1, autoAlpha: 0}, "<+.5");

        tLine.addLabel("noRandomInCore");
        tLine.to("#nar16",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar17",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar18",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar19",  {duration: .1, autoAlpha: 0});
        tLine.add(undoPlaneMove1(), "<");
        tLine.from("#nar20",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar20")});

        tLine.addLabel("whyNotAnAI");
        tLine.from("#nar21",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar21")});
        tLine.from("#the-ai", {duration: .5, autoAlpha:0});

        tLine.addLabel("startItWithAI");
        tLine.from("#nar22",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar22")});
        //tLine.set("#cmd1", {x: 380, y: 520}, ">+1");
        tLine.add(inputFromAI());
        tLine.add(appWorkAnim());
        tLine.fromTo("#cmd1", {x: 380, y: 520, autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");

        // Dup of above block
        // Need to fix the app-core-arrow

        tLine.fromTo("#app-core-arw", {duration: .5, autoAlpha: 0, scale: .1},{autoAlpha: 1, scale: 1, transformOrigin: "bottom right"}, ">");
        tLine.to("#cmd1", {x: 125, y:150, duration: 1}, ">");
        tLine.to("#spark1", {x: 125, y:150, duration: 1}, "<");
        tLine.to("#app-core-arw", {duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "top left"}, ">");
        tLine.add(coreWorkAnim());
        tLine.to("#cmd1", {duration: 1, autoAlpha: 0}, "<");
        tLine.add(coreArrowAnim(), ">-.25")
        tLine.add(planeMove1(), "<+.25");
        tLine.to("#spark1", {duration: 1, autoAlpha: 0}, "<+.5");

        tLine.addLabel("SometimesPrettyGood");
        tLine.to("#nar20",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar21",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar22",  {duration: .1, autoAlpha: 0});
        tLine.add(undoPlaneMove1(), "<-.3");
        tLine.fromTo("#app-core-arw", {duration: .5, autoAlpha: 0, scale: .1},{autoAlpha: 1, scale: 1, transformOrigin: "bottom right"});
        tLine.from("#nar23",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar23")});

        tLine.addLabel("Nope");
        tLine.from(["#big-red-x"], {duration: .25, rotation: -360, scale: .1, autoAlpha: 0});
        tLine.from("#nar24",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar24")});

        tLine.addLabel("showApian");
        tLine.to("#app-core-arw", {duration: .5, autoAlpha: 0});
        tLine.to("#big-red-x", {duration: .5, autoAlpha: 0});
        tLine.from("#nar25",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar25")});
        tLine.from(["#apian"], {duration: 1, rotation: -360, scale: .1, autoAlpha: 0});
        tLine.from("#apian-bkg", {duration: 1, autoAlpha: 0}, "<");

        tLine.addLabel("apCommands");
        tLine.to("#nar23",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar24",  {duration: .1, autoAlpha: 0});
        tLine.to("#nar25",  {duration: .1, autoAlpha: 0});
        tLine.from("#nar26",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar26")});
        tLine.set("#cmd1", {x: -260, y: 705});
        tLine.from("#nar27",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar27")}, ">+1");
        tLine.to("#cmd1", {duration: 1, autoAlpha: 1}, "<");

        tLine.addLabel("apRequests");
        tLine.set("#req1", {x: -260, y: 755});
        tLine.from("#nar28",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar28")});
        tLine.to("#req1", {duration: 1, autoAlpha: 1}, "<");

        tLine.addLabel("apObservations");
        tLine.set("#obs1", {x: -260, y: 805});
        tLine.from("#nar29",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar29")});
        tLine.to("#obs1", {duration: 1, autoAlpha: 1}, "<");

        tLine.addLabel("apianAppCorePair");
        tLine.to(["#obs1", "#req1","#cmd1"], {duration: .1, autoAlpha: 0});
        tLine.to(".narrative",  {duration: .1, autoAlpha: 0}, "<");
        tLine.from("#nar30",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar30")}, ">");
        tLine.from("#nar31",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar31")}, ">+1");

        tLine.addLabel("apianIsAProxy");
        tLine.from("#nar32",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar32")});

        tLine.addLabel("forACollective");
        tLine.to("#cloud-sm", {duration: 1, autoAlpha: 1});
        tLine.to("#app-frame", {duration: 1, left: 260}, "<");
        tLine.to("#cloud-zoom", {duration: 1, autoAlpha: 1}, "<");
        tLine.fromTo("#cloud-flash", {autoAlpha: 0}, {duration: .5, repeat: 8, yoyo: true, ease: "step", autoAlpha: 1}, "<");
        tLine.from("#nar33",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#nar33")}, ">");

        tLine.addLabel("asFarAsIvgotten");
        tLine.to(".narrative",  {duration: .1, autoAlpha: 0});
        tLine.to("#cmd1", {duration: 1, autoAlpha: 0}, "<");
        tLine.to("#obs1", {duration: 1, autoAlpha: 0}, "<");
        tLine.to("#req1", {duration: 1, autoAlpha: 0}, "<");
        tLine.from("#narsorry",  {duration: 1, autoAlpha: 0, onStart: ()=>hilightNar("#narsorry")})

        tLine.addLabel("userInputAgain");
        tLine.add(inputFromUser());
        tLine.set("#req1", {x: 380, y: 520});
        tLine.add(appWorkAnim());
        tLine.fromTo("#req1", {autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");

        tLine.addLabel("requestToApian");
        tLine.fromTo("#app-ap-arw", {autoAlpha: 0, scale: .1, }, { duration: .5, autoAlpha: 1, scale: 1, transformOrigin: "right"});
        tLine.fromTo("#req1", {x: 380, y: 520}, {x: 125, y: 500, duration: .5});
        tLine.fromTo("#spark1", {x: 380, y: 520}, {x: 125, y: 500, duration: .5}, "<");
        tLine.to("#app-ap-arw", { duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "left"});
        tLine.set("#cmd1", {x: 125, y: 500});
        tLine.add(apianWorkAnim());
        tLine.to("#req1", {autoAlpha: 0, duration: 1}, "<");
        tLine.fromTo("#cmd1", {autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");

        tLine.addLabel("apianMakesWork");
        tLine.fromTo("#ap-core-arw", {autoAlpha: 0, scale: .1},{duration: .5, autoAlpha: 1, scale: 1, transformOrigin: "bottom"});
        tLine.to("#cmd1", {x: 125, y:150, duration: 1});
        tLine.to("#spark1", {x: 125, y:150, duration: 1},"<");
        tLine.to("#ap-core-arw", {autoAlpha: 0, scale: .1, transformOrigin: "top"});
        tLine.add(coreWorkAnim());
        tLine.to("#cmd1", {duration: 1, autoAlpha: 0}, "<");
        tLine.add(coreArrowAnim(), ">-.25")
        tLine.add(planeMove1(), "<+.25");
        tLine.to("#spark1", {duration: 1, autoAlpha: 0}, "<+.5");




        // tLine.addLabel("whyNotAnAI");
        // tLine.from("#the-ai", {duration: .5, autoAlpha:0});
        // tLine.add(undoPlaneMove1(), "<");

        // tLine.addLabel("startItWithAI");
        // tLine.set("#spark1", {x: 520, y: 555});
        // tLine.to("#spark1",  {duration: .5, scale: 1, autoAlpha: 1});

        tLine.addLabel("onceAgain");
        tLine.to("#spark1", {x: 380, y:520, duration: 1});
        tLine.set("#req1", {x: 380, y: 520});
        tLine.add(appWorkAnim());
        tLine.fromTo("#req1", {autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");
        tLine.fromTo("#app-ap-arw", {autoAlpha: 0, scale: .1, }, { duration: .5, autoAlpha: 1, scale: 1, transformOrigin: "right"});
        tLine.fromTo("#req1", {x: 380, y: 520}, {x: 125, y: 500, duration: .5});
        tLine.fromTo("#spark1", {x: 380, y: 520}, {x: 125, y: 500, duration: .5},"<");
        tLine.to("#app-ap-arw", { duration: .5, autoAlpha: 0, scale: .1, transformOrigin: "left"});
        tLine.set("#cmd1", {x: 125, y: 500});
        tLine.add(apianWorkAnim());
        tLine.to("#req1", {autoAlpha: 0, duration: 1}, "<");
        tLine.fromTo("#cmd1", {autoAlpha: 0}, {autoAlpha:1, duration: 1}, "<");
        tLine.fromTo("#ap-core-arw", {autoAlpha: 0, scale: .1},{duration: .5, autoAlpha: 1, scale: 1, transformOrigin: "bottom"});
        tLine.to("#cmd1", {x: 125, y:150, duration: 1});
        tLine.to("#spark1", {x: 125, y:150, duration: 1},"<");
        tLine.to("#ap-core-arw", {autoAlpha: 0, scale: .1, transformOrigin: "top"});
        tLine.add(coreWorkAnim());
        tLine.to("#cmd1", {duration: 1, autoAlpha: 0}, "<");
        tLine.add(coreArrowAnim(), ">-.25")
        tLine.add(planeMove1(), "<+.25");
        tLine.to("#spark1", {duration: 1, autoAlpha: 0}, "<+.5");


        setupGotoLabels(tLine);
        tLine.pause();
        play_to_next();

        window.onresize = sizeSlideToWindow;
        sizeSlideToWindow();

        var paused = false;

        function disable_shuttle()
        {
            document.getElementById("shuttle").classList.add("shuttle-disabled");
        }

        function enable_shuttle()
        {
            document.getElementById("shuttle").classList.remove("shuttle-disabled");
        }

        function toggle_goto()
        {
            document.getElementById("shuttle").classList.toggle("goto-enabled");
        }

        function fast_fwd() {
            disable_shuttle();
            tLine.timeScale(5).tweenTo( tLine.nextLabel(), {onComplete: () => {tLine.timeScale(1);enable_shuttle()} });
        }

        function play_to_next() {
            disable_shuttle();
            tLine.tweenTo( tLine.nextLabel(),  {onComplete: () => enable_shuttle()} );
        }

        function rewind() {
            disable_shuttle();
            tLine.timeScale(5).tweenTo( tLine.previousLabel(), {onComplete: () => {tLine.timeScale(1); enable_shuttle()} });
        }

        function goto_label() {
            toggle_goto(); // disable it
            var gotoList = document.getElementById("gotoList");
            var targetLabel = gotoList.value;
            disable_shuttle();
            var speedScale = targetLabel == gotoList.firstChild.value ? 1 : 100; // slow if it's the 1st label to make sure it doesn't overrun the label
            tLine.timeScale(speedScale).restart().tweenTo( targetLabel, {onComplete: () => {tLine.timeScale(1);enable_shuttle()} });
        }

        function sizeSlideToWindow()
        {
            baseW = 1600;
            baseH = 900;
            scaleX = window.innerWidth / baseW;
            scaleY = window.innerHeight / baseH;
            newScale = (scaleX < scaleY) ? scaleX : scaleY;
            gsap.set("#slide", {x: 0, y: 0, scale: newScale, transformOrigin: "top left"});
        }

        function setupGotoLabels(timeLine)
        {
            var gotoList = document.getElementById("gotoList");
            for (label in timeLine.labels) {
                var opt = document.createElement('option');
                opt.value = label;
                opt.innerHTML = label;
                gotoList.appendChild(opt);
            }
        }

    </script>

</body>
</html>
